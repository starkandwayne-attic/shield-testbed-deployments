#!/bin/bash

export SHIELD_TARGET=http://10.244.2.11:8080

cat <<EOF | bkp create schedule
name: Daily Backups
when: daily 3am
EOF
SCHEDULE=$(bkp -r list schedules | jq -r .[].uuid)

cat <<EOF | bkp create retention policy
name:    Default Retention
expires: 8640000
EOF
RETENTION=$(bkp -r list retention policies | jq -r .[].uuid)

cat <<EOF | bkp create store
name:     cfstore
plugin:   s3
endpoint: '{"access_key_id":"REDACTED","bucket":"BUCKET","prefix":"bosh-lite-test","s3_host":"s3.amazonaws.com","secret_access_key":"REDACTED","skip_ssl_validation":false}'
EOF
STORE=$(bkp -r list stores | jq -r .[].uuid)

cat <<EOF | bkp create target
name:     cftarget
plugin:   postgres
endpoint: '{"pg_user": "vcap","pg_password": "c1oudc0w","pg_host": "localhost","pg_port": "5524","pg_bindir": "/var/vcap/packages/postgres-9.4.2/bin","pg_dump_args": ""}'
agent:    10.244.0.30:5444
EOF
TARGET=$(bkp -r list targets | jq -r .[].uuid)

cat <<EOF | bkp create job
name:      Shield DB Backups
target:    ${TARGET}
store:     ${STORE}
schedule:  ${SCHEDULE}
retention: ${RETENTION}
paused:    false
EOF
