#!/bin/bash

export SHIELD_TARGET=http://10.244.2.11:8080

SCHEDULE=$(cat <<EOF | shield --raw create schedule | jq -r .uuid
{"name": "Daily Backups",
 "when": "daily 3am"}
EOF)

RETENTION=$(cat <<EOF | shield --raw create retention policy | jq -r .uuid
{"name":    "Default Retention",
 "expires": 8640000}
EOF)

STORE=$(cat <<EOF | shield --raw create store | jq -r .uuid
{"name":     "Dummy Store",
 "plugin":   "dummy",
 "endpoint": "{\"directory\":\"/tmp/shield/dummy\"}"}
EOF)

TARGET=$(cat <<EOF | shield --raw create target | jq -r .uuid
{"name":     "Shield DB Backups",
 "plugin":   "postgres",
 "endpoint": "{\"pg_host\":\"localhost\",\"pg_port\":\"5224\",\"pg_user\":\"shieldadmin\",\"pg_password\":\"admin\",\"pg_database\":\"shielddb\"}",
 "agent":    "10.244.2.11:5444"}
EOF)

JOB=$(cat <<EOF | shield --raw create job | jq -r .uuid
{"name":      "Shield DB Backups",
 "target":    "${TARGET}",
 "store":     "${STORE}",
 "schedule":  "${SCHEDULE}",
 "retention": "${RETENTION}",
 "paused":    false}
EOF)

shield show job "${JOB}"
# vim:ft=bash
